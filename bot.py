import asyncio
import datetime
import aiohttp

TELEGRAM_BOT_TOKEN = "7858933900:AAH13QdgI1_xXJYt13tC2B9zRBIrlGuDJL8"
TELEGRAM_CHAT_ID = "582915868"

# –°–ª–æ–≤–∞—Ä—å —Å –≤—Ä–µ–º–µ–Ω–µ–º –Ω–∞–º–∞–∑–∞
PRAYER_TIMES = {
    "01-04-2025": {"–§–∞–¥–∂—Ä": "04:16", "–®—É—Ä—É–∫": "05:46", "–ó—É—Ö—Ä": "12:20", "–ê—Å—Ä": "15:54", "–ú–∞–≥—Ä–∏–±": "18:37", "–ò—à–∞": "20:17"},
    "02-04-2025": {"–§–∞–¥–∂—Ä": "04:14", "–®—É—Ä—É–∫": "05:44", "–ó—É—Ö—Ä": "12:19", "–ê—Å—Ä": "15:54", "–ú–∞–≥—Ä–∏–±": "18:37", "–ò—à–∞": "20:17"},
    "03-04-2025": {"–§–∞–¥–∂—Ä": "04:12", "–®—É—Ä—É–∫": "05:42", "–ó—É—Ö—Ä": "12:19", "–ê—Å—Ä": "15:55", "–ú–∞–≥—Ä–∏–±": "18:39", "–ò—à–∞": "20:19"},
    "04-04-2025": {"–§–∞–¥–∂—Ä": "04:10", "–®—É—Ä—É–∫": "05:40", "–ó—É—Ö—Ä": "12:19", "–ê—Å—Ä": "15:55", "–ú–∞–≥—Ä–∏–±": "18:40", "–ò—à–∞": "20:20"},
    "05-04-2025": {"–§–∞–¥–∂—Ä": "04:08", "–®—É—Ä—É–∫": "05:38", "–ó—É—Ö—Ä": "12:18", "–ê—Å—Ä": "15:56", "–ú–∞–≥—Ä–∏–±": "18:41", "–ò—à–∞": "20:21"},
    "06-04-2025": {"–§–∞–¥–∂—Ä": "04:07", "–®—É—Ä—É–∫": "05:37", "–ó—É—Ö—Ä": "12:18", "–ê—Å—Ä": "15:56", "–ú–∞–≥—Ä–∏–±": "18:43", "–ò—à–∞": "20:23"},
    "07-04-2025": {"–§–∞–¥–∂—Ä": "04:05", "–®—É—Ä—É–∫": "05:35", "–ó—É—Ö—Ä": "12:18", "–ê—Å—Ä": "15:56", "–ú–∞–≥—Ä–∏–±": "18:44", "–ò—à–∞": "20:24"},
    "08-04-2025": {"–§–∞–¥–∂—Ä": "04:03", "–®—É—Ä—É–∫": "05:33", "–ó—É—Ö—Ä": "12:18", "–ê—Å—Ä": "15:57", "–ú–∞–≥—Ä–∏–±": "18:45", "–ò—à–∞": "20:25"},
    "09-04-2025": {"–§–∞–¥–∂—Ä": "04:02", "–®—É—Ä—É–∫": "05:32", "–ó—É—Ö—Ä": "12:17", "–ê—Å—Ä": "15:57", "–ú–∞–≥—Ä–∏–±": "18:46", "–ò—à–∞": "20:26"},
    "10-04-2025": {"–§–∞–¥–∂—Ä": "04:00", "–®—É—Ä—É–∫": "05:30", "–ó—É—Ö—Ä": "12:17", "–ê—Å—Ä": "15:58", "–ú–∞–≥—Ä–∏–±": "18:47", "–ò—à–∞": "20:27"},
    "11-04-2025": {"–§–∞–¥–∂—Ä": "03:58", "–®—É—Ä—É–∫": "05:28", "–ó—É—Ö—Ä": "12:17", "–ê—Å—Ä": "15:58", "–ú–∞–≥—Ä–∏–±": "18:48", "–ò—à–∞": "20:28"},
    "12-04-2025": {"–§–∞–¥–∂—Ä": "03:56", "–®—É—Ä—É–∫": "05:26", "–ó—É—Ö—Ä": "12:16", "–ê—Å—Ä": "15:59", "–ú–∞–≥—Ä–∏–±": "18:50", "–ò—à–∞": "20:30"},
    "13-04-2025": {"–§–∞–¥–∂—Ä": "03:55", "–®—É—Ä—É–∫": "05:25", "–ó—É—Ö—Ä": "12:16", "–ê—Å—Ä": "16:00", "–ú–∞–≥—Ä–∏–±": "18:51", "–ò—à–∞": "20:31"},
    "14-04-2025": {"–§–∞–¥–∂—Ä": "03:53", "–®—É—Ä—É–∫": "05:23", "–ó—É—Ö—Ä": "12:16", "–ê—Å—Ä": "16:00", "–ú–∞–≥—Ä–∏–±": "18:52", "–ò—à–∞": "20:32"},
    "15-04-2025": {"–§–∞–¥–∂—Ä": "03:51", "–®—É—Ä—É–∫": "05:21", "–ó—É—Ö—Ä": "12:16", "–ê—Å—Ä": "16:00", "–ú–∞–≥—Ä–∏–±": "18:53", "–ò—à–∞": "20:33"},
    "16-04-2025": {"–§–∞–¥–∂—Ä": "03:50", "–®—É—Ä—É–∫": "05:20", "–ó—É—Ö—Ä": "12:16", "–ê—Å—Ä": "16:00", "–ú–∞–≥—Ä–∏–±": "18:54", "–ò—à–∞": "20:34"},
    "17-04-2025": {"–§–∞–¥–∂—Ä": "03:48", "–®—É—Ä—É–∫": "05:18", "–ó—É—Ö—Ä": "12:15", "–ê—Å—Ä": "16:01", "–ú–∞–≥—Ä–∏–±": "18:56", "–ò—à–∞": "20:36"},
    "18-04-2025": {"–§–∞–¥–∂—Ä": "03:46", "–®—É—Ä—É–∫": "05:16", "–ó—É—Ö—Ä": "12:15", "–ê—Å—Ä": "16:01", "–ú–∞–≥—Ä–∏–±": "18:57", "–ò—à–∞": "20:37"},
    "19-04-2025": {"–§–∞–¥–∂—Ä": "03:45", "–®—É—Ä—É–∫": "05:15", "–ó—É—Ö—Ä": "12:15", "–ê—Å—Ä": "16:02", "–ú–∞–≥—Ä–∏–±": "18:58", "–ò—à–∞": "20:38"},
    "20-04-2025": {"–§–∞–¥–∂—Ä": "03:43", "–®—É—Ä—É–∫": "05:13", "–ó—É—Ö—Ä": "12:15", "–ê—Å—Ä": "16:02", "–ú–∞–≥—Ä–∏–±": "18:59", "–ò—à–∞": "20:39"},
    "21-04-2025": {"–§–∞–¥–∂—Ä": "03:42", "–®—É—Ä—É–∫": "05:12", "–ó—É—Ö—Ä": "12:14", "–ê—Å—Ä": "16:02", "–ú–∞–≥—Ä–∏–±": "19:00", "–ò—à–∞": "20:40"},
    "22-04-2025": {"–§–∞–¥–∂—Ä": "03:40", "–®—É—Ä—É–∫": "05:10", "–ó—É—Ö—Ä": "12:14", "–ê—Å—Ä": "16:03", "–ú–∞–≥—Ä–∏–±": "19:01", "–ò—à–∞": "20:41"},
    "23-04-2025": {"–§–∞–¥–∂—Ä": "03:39", "–®—É—Ä—É–∫": "05:09", "–ó—É—Ö—Ä": "12:14", "–ê—Å—Ä": "16:03", "–ú–∞–≥—Ä–∏–±": "19:03", "–ò—à–∞": "20:43"},
    "24-04-2025": {"–§–∞–¥–∂—Ä": "03:37", "–®—É—Ä—É–∫": "05:07", "–ó—É—Ö—Ä": "12:14", "–ê—Å—Ä": "16:03", "–ú–∞–≥—Ä–∏–±": "19:04", "–ò—à–∞": "20:44"},
    "25-04-2025": {"–§–∞–¥–∂—Ä": "03:36", "–®—É—Ä—É–∫": "05:06", "–ó—É—Ö—Ä": "12:14", "–ê—Å—Ä": "16:04", "–ú–∞–≥—Ä–∏–±": "19:05", "–ò—à–∞": "20:45"},
    "26-04-2025": {"–§–∞–¥–∂—Ä": "03:34", "–®—É—Ä—É–∫": "05:04", "–ó—É—Ö—Ä": "12:14", "–ê—Å—Ä": "16:04", "–ú–∞–≥—Ä–∏–±": "19:06", "–ò—à–∞": "20:46"},
    "27-04-2025": {"–§–∞–¥–∂—Ä": "03:33", "–®—É—Ä—É–∫": "05:03", "–ó—É—Ö—Ä": "12:13", "–ê—Å—Ä": "16:05", "–ú–∞–≥—Ä–∏–±": "19:07", "–ò—à–∞": "20:47"},
    "28-04-2025": {"–§–∞–¥–∂—Ä": "03:31", "–®—É—Ä—É–∫": "05:01", "–ó—É—Ö—Ä": "12:13", "–ê—Å—Ä": "16:05", "–ú–∞–≥—Ä–∏–±": "19:09", "–ò—à–∞": "20:49"},
    "29-04-2025": {"–§–∞–¥–∂—Ä": "03:29", "–®—É—Ä—É–∫": "05:00", "–ó—É—Ö—Ä": "12:13", "–ê—Å—Ä": "16:05", "–ú–∞–≥—Ä–∏–±": "19:10", "–ò—à–∞": "20:50"},
    "30-04-2025": {"–§–∞–¥–∂—Ä": "03:27", "–®—É—Ä—É–∫": "04:58", "–ó—É—Ö—Ä": "12:13", "–ê—Å—Ä": "16:06", "–ú–∞–≥—Ä–∏–±": "19:11", "–ò—à–∞": "20:51"},
}


async def send_telegram_message(text):
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
    payload = {
        "chat_id": TELEGRAM_CHAT_ID,
        "text": text
    }
    async with aiohttp.ClientSession() as session:
        async with session.post(url, data=payload) as resp:
            return await resp.text()

async def prayer_notification_loop():
    msg = f"üïå Prayer tracker is running... "
    await send_telegram_message(msg)
    sent_today = set()
    while True:
        now = datetime.datetime.now()
        date_str = now.strftime("%d-%m-%Y")
        time_str = now.strftime("%H:%M")

        times = PRAYER_TIMES.get(date_str)
        if times:
            for prayer, t in times.items():
                if t == time_str and (date_str, prayer) not in sent_today:
                    msg = f"üïå –í—Ä–µ–º—è –º–æ–ª–∏—Ç–≤—ã: {prayer} ‚Äî {t}"
                    await send_telegram_message(msg)
                    sent_today.add((date_str, prayer))

        # –°–±—Ä–æ—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ 00:01 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
        if time_str == "00:01":
            sent_today.clear()

        await asyncio.sleep(30)  # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫

if __name__ == "__main__":
    asyncio.run(prayer_notification_loop())
